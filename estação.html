<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESTAÇÂO I</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mqtt/4.2.6/mqtt.js"></script>

</head>

<body>
    <h1>
        ESTAÇÃO 1
    </h1>
    <div id="div_principal"></div>
    <div id="div_lixeira"></div>
</body>
<script>

    const client = mqtt.connect("ws://test.mosquitto.org:8081/mqtt");
    var lixeira = document.querySelector("#div_lixeira")
    var div = document.querySelector("#div_principal")
    var list = []

    client.on("connect", function () {
        console.log("Conectado ao MQTT");
        div.innerHTML = "SUB: Conectado ao MQTT";
        //se inscrever em um tópico
        client.subscribe("GCS/lixeira");
    });
    function find_id(id){
        return list.find===id;

    }
    client.on("message", function (topic, message) {

        if (topic == "GCS/lixeira") {
            if (list.length == 0) {
                var json = JSON.parse(message.toString());
                console.log(json.id)
                list.push(json.id)
                console.log(list);

                // cria um novo elemento div e dá à ele conteúdo
                var divNova = document.createElement("div");
                divNova.id = "lix" + list[0];
                var conteudoNovo = document.createTextNode(message.toString());
                divNova.appendChild(conteudoNovo); //adiciona o nó de texto à nova div criada
                // adiciona o novo elemento criado e seu conteúdo ao DOM
                var divAtual = document.getElementById("div_lixeira");
                document.body.insertBefore(divNova, divAtual);

            } else {
                var json = JSON.parse(message.toString());
                if (list.find(item => item == json.id)) {
                    console.log(message.toString());
                    var bin = document.querySelector("#lix" + json.id)
                    bin.innerHTML = message.toString();
                } else {
                    var json = JSON.parse(message.toString());
                    list.push(json.id)
                    console.log(list);

                    // cria um novo elemento div e dá à ele conteúdo
                    var divNova = document.createElement("div");
                    divNova.id = "lix" + json.id;
                    var conteudoNovo = document.createTextNode(message.toString());
                    divNova.appendChild(conteudoNovo); //adiciona o nó de texto à nova div criada
                    // adiciona o novo elemento criado e seu conteúdo ao DOM
                    var divAtual = document.getElementById("div_lixeira");
                    document.body.insertBefore(divNova, divAtual);
                }

            }
            // console.log("LIXEIRAS: " + message.toString());
            //lixeira.innerHTML = "LIXEIRAS: " + message.toString();

        }
        // client.end()
    });

    console.log("a Conectar");
    div.innerHTML = "SUB: a conectar...";

</script>

</html>